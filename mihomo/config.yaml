######### é”šç‚¹ start #######
# proxy ç›¸å…³
pr: &pr {type: select, proxies: [ğŸé»˜è®¤,ğŸ‡­ğŸ‡°é¦™æ¸¯,ğŸ‡¹ğŸ‡¼å°æ¹¾,ğŸ‡¯ğŸ‡µæ—¥æœ¬,ğŸ‡¸ğŸ‡¬æ–°åŠ å¡,ğŸ‡ºğŸ‡¸ç¾å›½,ğŸ»å…¶å®ƒåœ°åŒº,ğŸŒå…¨éƒ¨èŠ‚ç‚¹,ğŸ›©ï¸è‡ªåŠ¨é€‰æ‹©,DIRECT]}

#è¿™é‡Œæ˜¯è®¢é˜…æ›´æ–°å’Œå»¶è¿Ÿæµ‹è¯•ç›¸å…³çš„
p: &p {type: http, interval: 83600, health-check: {enable: true, url: https://www.gstatic.com/generate_204, interval: 300}}

######### é”šç‚¹ end #######
b: &b {type: load-balance, include-all-providers: true, url: http://www.gstatic.com/generate_204, interval: 300, strategy: consistent-hashing, lazy: true}

u: &u {type: url-test, url: http://www.gstatic.com/generate_204, interval: 300, tolerance: 5, lazy: true, include-all-providers: true}
# url é‡Œå¡«å†™è‡ªå·±çš„è®¢é˜…,åç§°ä¸èƒ½é‡å¤
proxy-providers:
  sub1:
    <<: *p
    url: ""
    path: ./proxy_providers/sub1.yaml

  sub2:
    <<: *p
    url: ""
    path: ./proxy_providers/sub2.yaml

rule-providers:
  China_ip:
    type: http
    behavior: ipcidr
    url: "https://raw.githubusercontent.com/cbuijs/ipasn/master/country-asia-china.list"
    path: ./rule_providers/china_ip.list
    interval: 86400
    format: text
  
  Open:
    type: http
    behavior: classical
    url: "https://raw.githubusercontent.com/MRLQ/ios_rule_script/master/rule/Clash/OpenAI/OpenAI.yaml"
    path: ./rule_providers/openai.yaml
    interval: 864000
    
  tiktok:
    type: http
    behavior: classical
    url: "https://raw.githubusercontent.com/MRLQ/ios_rule_script/master/rule/Clash/TikTok/TikTok.yaml"
    path: ./rule_providers/tiktok.yaml
    interval: 864000
  
  China_ASN:
    type: http
    behavior: classical
    url: "https://github.com/VirgilClyne/GetSomeFries/raw/main/ruleset/ASN.China.yaml"
    path: ./rule_providers/asn.yaml
    interval: 864000

mode: rule
ipv6: false
log-level: info
allow-lan: true
mixed-port: 7890
tproxy-port: 1536
redir-port: 7891
unified-delay: false
tcp-concurrent: true
external-controller: 0.0.0.0:9090
external-ui: dashboard/xd
geodata-mode: true
geodata-loader: standard
geo-auto-update: true
geo-update-interval: 12
geox-url:
  geoip: "https://github.com/Loyalsoldier/v2ray-rules-dat/releases/latest/download/geoip.dat"
  geosite: "https://github.com/Loyalsoldier/v2ray-rules-dat/releases/latest/download/geosite.dat"
  mmdb: "https://testingcf.jsdelivr.net/gh/MetaCubeX/meta-rules-dat@release/country.mmdb"
  asn: "https://github.com/xishang0128/geoip/releases/download/latest/GeoLite2-ASN.mmdb"

find-process-mode: always
global-client-fingerprint: chrome

profile:
  store-selected: true
  store-fake-ip: true

sniffer:
  enable: true
  force-dns-mapping: true
  parse-pure-ip: true
  override-destination: true
  sniff:
    TLS:
      ports: [443, 8443]
    HTTP:
      ports: [80, 8080-8880]
      override-destination: true
    QUIC:
      ports: [443, 8443]
  skip-domain:
    - "Mijia Cloud"
tun:
  enable: true
  stack: system
  include-android-user:
    - 0
    - 10
    - 999
  exclude-package:
    - com.tencent.mm
    - 
  dns-hijack:
    - 'any:53'
    - 'tcp://any:53'
  gso: true
  gso-max-size: 65536
  auto-route: true
  strict-route: true
  auto-redirect: true
  auto-detect-interface: true

dns:
  enable: true
  # prefer-h3: true
  listen: :1053
  ipv6: false
  enhanced-mode: fake-ip
  fake-ip-range: 198.18.0.1/16
  fake-ip-filter:
    - '*'
    - '+.lan'
    - '+.local'

#ğŸé»˜è®¤ DNS, ç”¨äºè§£æ DNS æœåŠ¡å™¨ çš„åŸŸåï¼Œå¿…é¡»ä¸º IP, å¯ä¸ºåŠ å¯† DNS
  default-nameserver:
    - 223.6.6.6
    - https://1.12.12.12/dns-query
    - https://120.53.53.53/dns-query

# ğŸé»˜è®¤çš„åŸŸåè§£ææœåŠ¡å™¨ï¼Œå¦‚ä¸é…ç½® fallback/proxy-server-nameserver , åˆ™æ‰€æœ‰åŸŸåéƒ½ç”± nameserver è§£æ
  nameserver:
    # - 'https://dns.google/dns-query#dns&h3=true'
    # - 'https://dns.cloudflare.com/dns-query#dns&h3=true'
    - 'https://1.1.1.1/dns-query#dns'
    - 'https://8.8.8.8/dns-query#dns'

# ä»£ç†èŠ‚ç‚¹åŸŸåè§£ææœåŠ¡å™¨ï¼Œä»…ç”¨äºè§£æä»£ç†èŠ‚ç‚¹çš„åŸŸå
  proxy-server-nameserver:
    - https://1.12.12.12/dns-query
    - https://223.6.6.6/dns-query

#æŒ‡å®šåŸŸåæŸ¥è¯¢çš„è§£ææœåŠ¡å™¨ï¼Œå¯ä½¿ç”¨ geosite, ä¼˜å…ˆäº nameserver/fallback æŸ¥è¯¢
  nameserver-policy:
    "geosite:cn,private":
      - https://1.12.12.12/dns-query
      - https://223.6.6.6/dns-query

proxies:
  - name: "dns-out"
    type: dns

proxy-groups:

  - {name: ğŸé»˜è®¤, type: select, proxies: [ğŸ‡­ğŸ‡°é¦™æ¸¯, ğŸ‡¹ğŸ‡¼å°æ¹¾, ğŸ‡¯ğŸ‡µæ—¥æœ¬, ğŸ‡¸ğŸ‡¬æ–°åŠ å¡, ğŸ‡ºğŸ‡¸ç¾å›½, ğŸ»å…¶å®ƒåœ°åŒº, ğŸŒå…¨éƒ¨èŠ‚ç‚¹, ğŸ›©ï¸è‡ªåŠ¨é€‰æ‹©, ğŸ‡­ğŸ‡°é¦™æ¸¯-è´Ÿè½½å‡è¡¡, ğŸ‡¹ğŸ‡¼å°æ¹¾-è´Ÿè½½å‡è¡¡, ğŸ‡¯ğŸ‡µæ—¥æœ¬-è´Ÿè½½å‡è¡¡, ğŸ‡¸ğŸ‡¬æ–°åŠ å¡-è´Ÿè½½å‡è¡¡, ğŸ‡ºğŸ‡¸ç¾å›½-è´Ÿè½½å‡è¡¡]}

  - {name: dns, type: select, proxies: [ğŸé»˜è®¤, ğŸŒå…¨éƒ¨èŠ‚ç‚¹, ğŸ‡­ğŸ‡°é¦™æ¸¯, ğŸ‡¹ğŸ‡¼å°æ¹¾, ğŸ‡¯ğŸ‡µæ—¥æœ¬, ğŸ‡¸ğŸ‡¬æ–°åŠ å¡, ğŸ‡ºğŸ‡¸ç¾å›½, ğŸ»å…¶å®ƒåœ°åŒº, ğŸ‡­ğŸ‡°é¦™æ¸¯-è´Ÿè½½å‡è¡¡, ğŸ‡¹ğŸ‡¼å°æ¹¾-è´Ÿè½½å‡è¡¡, ğŸ‡¯ğŸ‡µæ—¥æœ¬-è´Ÿè½½å‡è¡¡, ğŸ‡¸ğŸ‡¬æ–°åŠ å¡-è´Ÿè½½å‡è¡¡, ğŸ‡ºğŸ‡¸ç¾å›½-è´Ÿè½½å‡è¡¡]}

  - {name: ğŸŒå…¨éƒ¨èŠ‚ç‚¹, type: select ,include-all-providers: true}

  - {name: ğŸŒ€Google, <<: *pr}
  
  - {name: ğŸ–ï¸OpenAI,include-all-providers: true, filter: "(?i)ç¾|us|ğŸ‡ºğŸ‡¸|unitedstates|united states", <<: *pr}

  - {name: ğŸ“±Telegram, <<: *pr}

  - {name: ğŸ¿Twitter, <<: *pr}

  - {name: ğŸ³Pixiv, <<: *pr}
  
  - {name: ğŸ“½ï¸Tiktok,include-all-providers: true, filter: "(?i)ç¾|ğŸ‡ºğŸ‡¸|us|unitedstates|united states", <<: *pr}

  - {name: ğŸ‘’Ehentai, <<: *pr}

  - {name: ğŸ”¥å“”å“©å“”å“©, <<: *pr}

  - {name: ğŸ›¶å“”å“©ä¸œå—äºš, <<: *pr}

  - {name: ğŸŒ€å·´å“ˆå§†ç‰¹, <<: *pr}

  - {name: ğŸ³Youtube, <<: *pr}

  - {name: ğŸ“»Netflix, <<: *pr}

  - {name: ğŸ¼Spotify, <<: *pr}

  - {name: ğŸ›µGithub, <<: *pr}

  - {name: ğŸ‡¨ğŸ‡³å›½å†…, type: select, proxies: [DIRECT, ğŸé»˜è®¤]}

  - {name: ğŸ¦ˆæ¼ç½‘ä¹‹é±¼, <<: *pr}

#åˆ†éš”,ä¸‹é¢æ˜¯åœ°åŒºåˆ†ç»„
  - {name: ğŸ‡­ğŸ‡°é¦™æ¸¯, filter: "(?i)æ¸¯|hk|ğŸ‡­ğŸ‡°|hongkong|hong kong", <<: *u}

  - {name: ğŸ‡¹ğŸ‡¼å°æ¹¾, filter: "(?i)å°|tw|ğŸ‡¹ğŸ‡¼|taiwan", <<: *u}

  - {name: ğŸ‡¯ğŸ‡µæ—¥æœ¬, filter: "(?i)ğŸ‡¯ğŸ‡µ|æ—¥æœ¬|jp|japan", <<: *u}

  - {name: ğŸ‡ºğŸ‡¸ç¾å›½, filter: "(?i)ç¾|ğŸ‡ºğŸ‡¸|us|unitedstates|united states", <<: *u}

  - {name: ğŸ‡¸ğŸ‡¬æ–°åŠ å¡, filter: "(?i)(æ–°|ğŸ‡¸ğŸ‡¬|sg|singapore|ç‹®åŸ)", <<: *u}
  
  - { name: ğŸ‡­ğŸ‡°é¦™æ¸¯-è´Ÿè½½å‡è¡¡, <<: *b, exclude-filter: "vless|trojan", filter: "(?i)æ¸¯|hk|hongkong|hong kong|é¦™æ¸¯|ğŸ‡­ğŸ‡°" }
  - { name: ğŸ‡¹ğŸ‡¼å°æ¹¾-è´Ÿè½½å‡è¡¡, <<: *b, exclude-filter: "vless|trojan", filter: "(?i)å°|tw|taiwan|ğŸ‡¨ğŸ‡³" }
  - { name: ğŸ‡¯ğŸ‡µæ—¥æœ¬-è´Ÿè½½å‡è¡¡, <<: *b, exclude-filter: "vless|trojan", filter: "(?i)æ—¥æœ¬|jp|japan|ğŸ‡¯ğŸ‡µ" }
  - { name: ğŸ‡ºğŸ‡¸ç¾å›½-è´Ÿè½½å‡è¡¡, <<: *b, exclude-filter: "vless|trojan", filter: "(?i)ç¾|us|unitedstates|united states|ğŸ‡ºğŸ‡¸" }
  - { name: ğŸ‡¸ğŸ‡¬æ–°åŠ å¡-è´Ÿè½½å‡è¡¡, <<: *b, exclude-filter: "vless|trojan", filter: "(?i)(æ–°|sg|singapore|ğŸ‡¸ğŸ‡¬)" }

  - {name: ğŸ»å…¶å®ƒåœ°åŒº, type: select ,include-all-providers: true, filter: "(?i)^(?!.*(?:ğŸ‡­ğŸ‡°|ğŸ‡¯ğŸ‡µ|ğŸ‡ºğŸ‡¸|ğŸ‡¸ğŸ‡¬|ğŸ‡¨ğŸ‡³|æ¸¯|ğŸ‡¹ğŸ‡¼|hk|hongkong|å°|tw|taiwan|æ—¥|jp|japan|æ–°|sg|singapore|ç‹®åŸ|ç¾|us|unitedstates)).*"}


  - {name: ğŸ›©ï¸è‡ªåŠ¨é€‰æ‹©, include-all-providers: true, tolerance: 10, type: url-test}

rules:
  - PROCESS-NAME,com.android.vending,ğŸé»˜è®¤
  - OR,((DST-PORT,22),(DST-PORT,33333)),ğŸé»˜è®¤
  # - OR,((GEOSITE,category-httpdns),(DOMAIN-KEYWORD,httpdns)),REJECT
  - AND,((NETWORK,udp),(OR,(GEOSITE,google),(GEOIP,google))),REJECT
  - AND,((DST-PORT,53),(DST-PORT,853)),ğŸé»˜è®¤
  - OR,((AND,((DST-PORT,443),(NETWORK,udp),(GEOSITE,!cn))),(AND,((DST-PORT,443),(NETWORK,udp),(GEOIP,!cn)))),ğŸé»˜è®¤
  - DOMAIN-REGEX,^.*googlevideo\.com$,ğŸŒ€Google
  - DOMAIN-KEYWORD,google,ğŸŒ€Google
  - DOMAIN-REGEX,(?:https?:\/\/)?(?:[a-zA-Z0-9_-]+\.)?(?:[a-zA-Z0-9_-]+\.)?google[a-zA-Z0-9_-]*\.[a-z]{2,},ğŸŒ€Google
  - DOMAIN-REGEX,"^(alt[1-8]-)?mtalk4?(-(staging|dev))?\\.google\\.com$",ğŸŒ€Google
  - RULE-SET,Open,ğŸ–ï¸OpenAI
  - RULE-SET,tiktok,ğŸ“½ï¸Tiktok
  - GEOSITE,private,DIRECT
  - GEOSITE,openai,ğŸ–ï¸OpenAI
  # - GEOSITE,biliintl,ğŸ›¶å“”å“©ä¸œå—äºš
  - GEOSITE,ehentai,ğŸ‘’Ehentai
  - GEOSITE,github,ğŸ›µGithub
  - GEOSITE,twitter,ğŸ¿Twitter
  - GEOSITE,youtube,ğŸ³Youtube
  - GEOSITE,google,ğŸŒ€Google
  - GEOSITE,telegram,ğŸ“±Telegram
  - GEOSITE,netflix,ğŸ“»Netflix
  - GEOSITE,bilibili,ğŸ”¥å“”å“©å“”å“©
  - GEOSITE,bahamut,ğŸŒ€å·´å“ˆå§†ç‰¹
  - GEOSITE,spotify,ğŸ¼Spotify
  - GEOSITE,geolocation-!cn,ğŸé»˜è®¤
  - GEOSITE,geolocation-cn,DIRECT

  # - AND,(AND,(DST-PORT,443),(NETWORK,UDP)),(NOT,((GEOIP,CN))),REJECT # quic
  - IP-SUFFIX,8.8.8.8/24,dns,no-resolve
  - IP-SUFFIX,8.8.4.4/24,dns,no-resolve
  - IP-SUFFIX,1.1.1.1/24,dns,no-resolve
  - IP-SUFFIX,1.0.0.1/24,dns,no-resolve
  
  - GEOIP,private,DIRECT
  - GEOIP,google,ğŸŒ€Google
  - GEOIP,netflix,ğŸ“»Netflix
  - GEOIP,telegram,ğŸ“±Telegram
  - GEOIP,twitter,ğŸ¿Twitter
  - GEOSITE,pixiv,ğŸ³Pixiv
  - RULE-SET,China_ASN,ğŸ‡¨ğŸ‡³å›½å†…
  - OR,((GEOSITE,CN),(GEOIP,CN)),ğŸ‡¨ğŸ‡³å›½å†…
  - RULE-SET,China_ip,ğŸ‡¨ğŸ‡³å›½å†…
  - MATCH,ğŸ¦ˆæ¼ç½‘ä¹‹é±¼
